{% load i18n %}
{% load extras %}

<div class="tabView">
  <ul class="tabs">
   <li><a href="#general">{% trans "Yleiset" %}</a></li><li><a href="#parts">{% trans "Varaosat" %}</a></li><li><a href="#customer">{% trans "Asiakas" %}</a></li>
  </ul>
<form method="post" accept-charset="utf-8" action="/orders/submit_gsx_repair">
  {% csrf_token %}
  <input type="hidden" name="ws_account" value="{{ ws_account }}"/>
  <input type="hidden" name="order_number" value="{{ order.number }}"/>
  <input type="hidden" name="customerAddress.state" value="ZZ"/>
  <input type="hidden" name="customerAddress.regionCode" value="004"/>
  <input type="hidden" name="customerAddress.country" value="FIN"/>
  <div class="tab" id="general">
    <label>{% trans "Laite" %}:</label>
    <select name="sn" style="width:365px">
{% for dev in order.devices %}
      <option value="{{ dev.sn }}">{{ dev.sn }} - {{ dev.description }}</option>
{% endfor %}
    </select>
    <br/>
    <select class="label chooser" rel="symptom">
      <option value="0">{% trans "Vikakuvaus" %}…</option>
{% for tpl in templates %}
      <option value="{{ tpl.id }}">{{ tpl.title }}</option>
{% endfor %}
    </select>
    <textarea id="symptom" name="symptom">{{ symptom }}</textarea>
    <br/>
    <select class="label chooser" rel="diagnosis">
      <option value="0">{% trans "Diagnoosi" %}…</option>
{% for tpl in templates %}
      <option value="{{ tpl.id }}">{{ tpl.title }}</option>
{% endfor %}
     </select>
    <textarea id="diagnosis" name="diagnosis"></textarea>
    <br/>
    <label>{% trans "Luotu" %}:</label>
    <input
      type="text"
      name="unitReceivedDate"
      class="datepicker short"
      value="{{ order.created_at|gsx_date }}"/>
    <input
      type="text"
      class="short"
      name="unitReceivedTime"
      value="{{ order.created_at|gsx_time }}"/>
    <br/>
    <label>{% trans "Liite" %}:</label>
    <input type="file" name="incoming"/>
    <br/>
    <label></label>
    <input type="hidden" name="requestReview" value="N"/>
    <input type="checkbox" name="requestReview" value="Y"/>
    <span>{% trans "request review" %}</span>
    <br/>
  </div><!-- //#general -->
    
    <div class="tab" id="parts">
{% for part in parts %}
        <input
            type="text"
            class="short"
            readonly="readonly"
            value="{{ part.code }}"
            name="items.{{ forloop.counter0 }}.partNumber"/>
        <select name="items.{{ forloop.counter0 }}.comptiaCode">
          <option value="">{% trans "Valitse" %}...</option>
          {% for k, v in part.symptoms.items %}
          <option value="{{ k }}">{{ k }} - {{ v }}</option>
          {% endfor %}
        </select>
        <select name="items.{{ forloop.counter0 }}.comptiaModifier">
          <option value="">{% trans "Valitse" %}...</option>
          {% for k, v in modifiers.items %}
          <option value="{{ k }}">{{ k }} - {{ v }}</option>
          {% endfor %}
        </select>
        <select name="items.{{ forloop.counter0 }}.abused" style="width:60px">
          <option value="N">{% trans "Takuu" %}</option>
          <option value="Y">{% trans "Vahinko" %}</option>
        </select>
        <br/>
{% endfor %}
    </div><!-- //#parts -->
    <div class="tab" id="customer">
      <label>{% trans "Etunimi" %}:</label>
      <input type="text" name="customerAddress.firstName" value="{{ customer.firstName }}"/>
      <br/>
      <label>{% trans "Sukunimi" %}:</label>
      <input type="text" name="customerAddress.lastName" value="{{ customer.lastName }}"/>
      <br/>
      <label>{% trans "Sähköposti" %}:</label>
      <input type="text" name="customerAddress.emailAddress" value="{{ customer.emailAddress }}"/>
      <br/>
      <label>{% trans "Puhelin" %}:</label>
      <input type="text" name="customerAddress.primaryPhone" value="{{ customer.primaryPhone }}"/>
      <br/>
      <label>{% trans "Katuosoite" %}:</label>
      <input type="text" name="customerAddress.addressLine1" value="{{ customer.adressLine1 }}"/>
      <br/>
      <label>{% trans "Postinumero" %}:</label>
      <input type="text" name="customerAddress.zipCode" value="{{ customer.zip }}"/>
      <br/>
      <label>{% trans "Toimipaikka" %}:</label>
      <input type="text" name="customerAddress.city" value="{{ customer.city }}"/>
    </div><!-- //#customer -->
</form>
</div>
<script type="text/javascript">
  $(".datepicker").datepicker({format: ""});
  $(".chooser").change( function() {
      var ta = "#" + $(this).attr("rel");
      $(ta).load("/template/view/" + $(this).val());
  });
</script>
